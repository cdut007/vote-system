<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <process id="expert_choose_work_flow" name="专家组长选举流程" isExecutable="true">
    <startEvent id="startevent11" name="等待专家组长选举"></startEvent>
    <userTask id="usertask34" name="选举评标组长" activiti:assignee="${userId}" activiti:formKey="expert/expertVote">
      <documentation>${projectInstanceName} 评标专家投票选举组长</documentation>
      <multiInstanceLoopCharacteristics isSequential="false" activiti:collection="${expertIdSign}" activiti:elementVariable="userId"></multiInstanceLoopCharacteristics>
    </userTask>
    <endEvent id="endevent20" name="End"></endEvent>
    <sequenceFlow id="flow218" sourceRef="usertask34" targetRef="servicetask1">
      <extensionElements>
        <activiti:executionListener event="take" expression="${expertSignEndListener.execute(execution)}"></activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <scriptTask id="scripttask1" name="变量初始化" scriptFormat="groovy" activiti:autoStoreVariables="false">
      <script>def expertApplyId=execution.getVariable("expertApplyId");
      	
      </script>
    </scriptTask>
    <userTask id="usertask35" name="指定评标组长" activiti:assignee="${dlrzj0}" activiti:formKey="expert/organVote">
      <documentation>${projectInstanceName} 评标专家组长指定</documentation>
    </userTask>
    <exclusiveGateway id="exclusivegateway4" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow226" sourceRef="exclusivegateway4" targetRef="usertask34">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${expertElect=='0'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow227" sourceRef="exclusivegateway4" targetRef="usertask35">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${expertElect!='0'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow228" sourceRef="usertask35" targetRef="servicetask1">
      <extensionElements>
        <activiti:executionListener event="take" expression="${expertSignEndListener.execute(execution)}"></activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow238" sourceRef="startevent11" targetRef="scripttask1"></sequenceFlow>
    <sequenceFlow id="flow260" sourceRef="scripttask1" targetRef="exclusivegateway4"></sequenceFlow>
    <userTask id="usertask36" name="组长任务划分" activiti:assignee="${ZZZJ00}" activiti:formKey="expert/expertGroup/assign">
      <documentation>${projectInstanceName} 评标专家详细评审任务安排</documentation>
    </userTask>
    <sequenceFlow id="flow261" sourceRef="usertask36" targetRef="servicetask2"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway5" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow264" sourceRef="exclusivegateway5" targetRef="usertask36">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${needAssign}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow265" sourceRef="exclusivegateway5" targetRef="servicetask2">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${!needAssign}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask1" name="获取组长" activiti:expression="${expertGroupService.checkNeedTaskAssign(execution)}"></serviceTask>
    <sequenceFlow id="flow266" sourceRef="servicetask1" targetRef="exclusivegateway5"></sequenceFlow>
    <serviceTask id="servicetask2" name="服务处理" activiti:expression="${bidOpenCheckService.openPreliminaryBid(execution)}"></serviceTask>
    <sequenceFlow id="flow267" sourceRef="servicetask2" targetRef="endevent20"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_expert_choose_work_flow">
    <bpmndi:BPMNPlane bpmnElement="expert_choose_work_flow" id="BPMNPlane_expert_choose_work_flow">
      <bpmndi:BPMNShape bpmnElement="startevent11" id="BPMNShape_startevent11">
        <omgdc:Bounds height="35.0" width="35.0" x="470.0" y="38.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask34" id="BPMNShape_usertask34">
        <omgdc:Bounds height="55.0" width="105.0" x="290.0" y="188.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent20" id="BPMNShape_endevent20">
        <omgdc:Bounds height="35.0" width="35.0" x="874.0" y="540.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="scripttask1" id="BPMNShape_scripttask1">
        <omgdc:Bounds height="55.0" width="105.0" x="290.0" y="44.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask35" id="BPMNShape_usertask35">
        <omgdc:Bounds height="55.0" width="105.0" x="280.0" y="338.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway4" id="BPMNShape_exclusivegateway4">
        <omgdc:Bounds height="40.0" width="40.0" x="50.0" y="255.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask36" id="BPMNShape_usertask36">
        <omgdc:Bounds height="55.0" width="105.0" x="760.0" y="231.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway5" id="BPMNShape_exclusivegateway5">
        <omgdc:Bounds height="40.0" width="40.0" x="600.0" y="380.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask1" id="BPMNShape_servicetask1">
        <omgdc:Bounds height="55.0" width="105.0" x="522.0" y="130.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask2" id="BPMNShape_servicetask2">
        <omgdc:Bounds height="55.0" width="105.0" x="804.0" y="399.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow218" id="BPMNEdge_flow218">
        <omgdi:waypoint x="395.0" y="215.0"></omgdi:waypoint>
        <omgdi:waypoint x="574.0" y="185.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow226" id="BPMNEdge_flow226">
        <omgdi:waypoint x="70.0" y="255.0"></omgdi:waypoint>
        <omgdi:waypoint x="342.0" y="243.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow227" id="BPMNEdge_flow227">
        <omgdi:waypoint x="70.0" y="295.0"></omgdi:waypoint>
        <omgdi:waypoint x="332.0" y="338.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow228" id="BPMNEdge_flow228">
        <omgdi:waypoint x="332.0" y="338.0"></omgdi:waypoint>
        <omgdi:waypoint x="574.0" y="185.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow238" id="BPMNEdge_flow238">
        <omgdi:waypoint x="470.0" y="55.0"></omgdi:waypoint>
        <omgdi:waypoint x="395.0" y="71.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow260" id="BPMNEdge_flow260">
        <omgdi:waypoint x="342.0" y="99.0"></omgdi:waypoint>
        <omgdi:waypoint x="70.0" y="255.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow261" id="BPMNEdge_flow261">
        <omgdi:waypoint x="812.0" y="286.0"></omgdi:waypoint>
        <omgdi:waypoint x="856.0" y="399.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow264" id="BPMNEdge_flow264">
        <omgdi:waypoint x="620.0" y="380.0"></omgdi:waypoint>
        <omgdi:waypoint x="812.0" y="286.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow265" id="BPMNEdge_flow265">
        <omgdi:waypoint x="640.0" y="400.0"></omgdi:waypoint>
        <omgdi:waypoint x="804.0" y="426.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow266" id="BPMNEdge_flow266">
        <omgdi:waypoint x="574.0" y="185.0"></omgdi:waypoint>
        <omgdi:waypoint x="620.0" y="380.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow267" id="BPMNEdge_flow267">
        <omgdi:waypoint x="856.0" y="454.0"></omgdi:waypoint>
        <omgdi:waypoint x="891.0" y="540.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>