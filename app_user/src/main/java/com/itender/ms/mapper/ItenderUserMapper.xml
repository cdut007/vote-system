<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itender.ms.mapper.ItenderUserMapper">
    <resultMap id="itenderUser" type="com.itender.ms.domain.ItenderUser">
    	<id column="id" javaType="String" property="id"></id>
        <result column="user_name" javaType="STRING" property="userName"></result>
		<result column="nick_name" javaType="STRING" property="nickName"></result>
		<result column="phone" javaType="STRING" property="phone"></result>
		<result column="company" javaType="STRING" property="company"></result>
        <result column="position" javaType="STRING" property="position"></result>
        <result column="email" javaType="STRING" property="email"></result>
		<result column="pass_word" javaType="STRING" property="password"></result>
		<result column="register_time" javaType="DATE" property="registerTime"></result>
        <result column="register_ip" javaType="STRING" property="registerIp"></result>
        <result column="last_login_time" javaType="DATE" property="lastLoginTime"></result>
        <result column="last_login_ip" javaType="STRING" property="lastLoginIp"></result>
        <result column="is_default_admin" javaType="Boolean" property="isDefaultAdmin"></result>
        <result column="create_time" javaType="DATE" property="createTime"></result>
        <result column="update_time" javaType="DATE" property="updateTime"></result>
        <result column="operator" javaType="STRING" property="operator"></result>
        <collection property="roles" ofType="com.itender.ms.domain.ItenderRole" javaType="java.util.List">
        	<id column="role_id" property="id"/>
          	<result column="role_name" property="roleName"/>
        </collection>
    </resultMap>

	 <select id="selectByUserId" parameterType="java.lang.String" resultMap="itenderUser">
		SELECT 
			a.*,c.id role_id,c.role_name
		FROM 
			itender_user a
		LEFT JOIN 
			itender_user_role b
		ON 
			b.user_id=a.id
		LEFT JOIN 
			itender_role c
		ON 
			c.id=b.role_id
		WHERE
			a.id= #{userId,jdbcType=VARCHAR} 
    </select>

    <select id="selectByNameAndPassword" parameterType="com.itender.ms.domain.ItenderUser" resultMap="itenderUser">
    	SELECT  
    		a.*,c.id role_id,c.role_name
    	FROM  
    		itender_user a
		LEFT JOIN 
			itender_user_role b
		ON 
			b.user_id=a.id
		LEFT JOIN 
			itender_role c
		ON 
			c.id=b.role_id
    	WHERE 
    		a.user_name = #{userName,jdbcType=VARCHAR}
    	AND 
    		a.pass_word = #{password,jdbcType=VARCHAR}
    </select>
    
    <update id="updateUser" parameterType="com.itender.ms.domain.ItenderUser">
    	UPDATE itender_user
    	<trim prefix="SET" suffixOverrides=",">
			<if test="userName != null">user_name=#{userName},</if>
			<if test="nickName != null">nick_name=#{nickName},</if>
			<if test="phone != null">phone=#{phone},</if>
			<if test="company != null">company=#{company},</if>
			<if test="position != null">position=#{position},</if>
			<if test="email != null">email=#{email},</if>
			<if test="password != null">pass_word=#{password},</if>
			<if test="registerTime != null">register_time=#{registerTime},</if>
			<if test="registerIp != null">register_ip=#{registerIp},</if>
			<if test="lastLoginTime != null">last_login_time=#{lastLoginTime},</if>
			<if test="lastLoginIp != null">last_login_ip=#{lastLoginIp},</if>
		</trim>
        WHERE id = #{id}
    </update>
</mapper>